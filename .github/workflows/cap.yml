name: auto_deployment

on:
  workflow_dispatch:

jobs:
  deployment-job:
      name: Deploy
      runs-on: ubuntu-latest
      steps:
        - name: SSH into the machine and run some commands
          uses: appleboy/ssh-action@master
          with:
            host: 35.164.77.158
            username: runcloud
            key:  ${{ secrets.SH_SSH }}
            port: 22
            script: |
              cd /home/runcloud/webapps/cic_test/tools/cap
              echo "Running deployment script on the server"
              cap local deploy
        - name: Make Request
          id: myRequest
          uses: fjogeleit/http-request-action@v1
          with:
            url: "https://cic-deploy.humdash.com/"
        - name: Show Response
          run: |
            echo ${{ steps.myRequest.outputs.response }}
            echo ${{ steps.myRequest.outputs.headers }}
            echo ${{ fromJson(steps.myRequest.outputs.response) }}
